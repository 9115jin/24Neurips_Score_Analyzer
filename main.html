<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NeurIPS 2024 Î¶¨Î∑∞ Ï†êÏàò Î∂ÑÏÑùÍ∏∞</title>
    <script src="https://cdnjs.cloudflare.com/ajaxlibs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }
        
        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 30px;
            font-size: 2.5em;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .control-group {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }
        
        .control-group:hover {
            border-color: #667eea;
            transform: translateY(-2px);
        }
        
        label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: #2c3e50;
        }
        
        input, select, button {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        button {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            cursor: pointer;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s ease;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }
        
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .progress {
            margin: 20px 0;
            background: #f0f0f0;
            border-radius: 10px;
            overflow: hidden;
            height: 20px;
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(45deg, #667eea, #764ba2);
            width: 0%;
            transition: width 0.3s ease;
            position: relative;
        }
        
        .progress-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-weight: 600;
            font-size: 12px;
        }
        
        .status {
            margin: 20px 0;
            padding: 15px;
            border-radius: 10px;
            font-weight: 500;
        }
        
        .status.info {
            background: #e3f2fd;
            color: #1976d2;
            border-left: 5px solid #2196f3;
        }
        
        .status.success {
            background: #e8f5e8;
            color: #2e7d32;
            border-left: 5px solid #4caf50;
        }
        
        .status.error {
            background: #ffebee;
            color: #c62828;
            border-left: 5px solid #f44336;
        }
        
        .results {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-top: 30px;
        }
        
        .chart-container {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        
        .stats {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        
        .stat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .stat-item:last-child {
            border-bottom: none;
        }
        
        .stat-label {
            font-weight: 600;
            color: #2c3e50;
        }
        
        .stat-value {
            font-size: 1.2em;
            font-weight: 700;
            color: #667eea;
        }
        
        @media (max-width: 768px) {
            .results {
                grid-template-columns: 1fr;
            }
            
            .controls {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß† NeurIPS 2024 Î¶¨Î∑∞ Ï†êÏàò Î∂ÑÏÑùÍ∏∞</h1>
        
        <div id="statusdiv"></div>
        
        <div class="results" id="results">
            <div class="chart-container">
                <h3 style="text-align: center; color: #2c3e50; margin-bottom: 20px;">Ï†êÏàò Î∂ÑÌè¨ ÌûàÏä§ÌÜ†Í∑∏Îû®</h3>
                <canvas id="histogramChart"></canvas>
            </div>
            
            <div class="stats">
                <h3 style="text-align: center; color: #2c3e50; margin-bottom: 20px;">ÌÜµÍ≥Ñ ÏöîÏïΩ</h3>
                <div id="statsContent"></div>
            </div>
        </div>
        
        <div class="personal-score-section" id="personalScoreSection">
            <div class="control-group" style="margin-top: 30px;">
                <h3 style="color: #2c3e50; margin-bottom: 20px; text-align: center;">üéØ ÎÇ¥ ÎÖºÎ¨∏ Ï†êÏàò Î∂ÑÏÑù</h3>
                <label for="personalScores">Î¶¨Î∑∞Ïñ¥ Ï†êÏàòÎì§ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî (ÏâºÌëúÎ°ú Íµ¨Î∂Ñ)</label>
                <input type="text" id="personalScores" placeholder="Ïòà: 4,4,5 ÎòêÎäî 6,7,5,6" style="margin-bottom: 10px;">
                <button onclick="analyzePersonalScore()" style="background: linear-gradient(45deg, #ff6b6b, #ee5a24);">ÎÇ¥ Ï†êÏàò Î∂ÑÏÑùÌïòÍ∏∞</button>
                <div id="personalAnalysis" style="margin-top: 20px;"></div>
            </div>
        </div>
    </div>

    <script>
        let allScores = [];
        let chart = null;
        
        const categories = [
            { name: 'Oral', url: 'https://openreview.net/group?id=NeurIPS.cc/2024/Conference#tab-accept-oral' },
            { name: 'Spotlight', url: 'https://openreview.net/group?id=NeurIPS.cc/2024/Conference#tab-accept-spotlight' },
            { name: 'Poster', url: 'https://openreview.net/group?id=NeurIPS.cc/2024/Conference#tab-accept-poster' },
            { name: 'Reject', url: 'https://openreview.net/group?id=NeurIPS.cc/2024/Conference#tab-reject' }
        ];
        
        function updateStatus(message, type = 'info') {
            const statusDiv = document.getElementById('statusdiv'); // 'status' -> 'statusdiv'Î°ú Î≥ÄÍ≤Ω
            statusDiv.innerHTML = `<div class="status ${type}">${message}</div>`;
        }
        
        function updateProgress(current, total) {
            const progressBar = document.getElementById('progressBar');
            const progressText = document.getElementById('progressText');
            const percentage = Math.round((current / total) * 100);
            
            progressBar.style.width = percentage + '%';
            progressText.textContent = `${percentage}% (${current}/${total})`;
        }
        
        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }
        
        async function fetchWithRetry(url, retries = 3) {
            for (let i = 0; i < retries; i++) {
                try {
                    const response = await fetch(url);
                    if (response.ok) {
                        return await response.text();
                    }
                    throw new Error(`HTTP ${response.status}`);
                } catch (error) {
                    if (i === retries - 1) throw error;
                    await sleep(2000);
                }
            }
        }
        
        function extractPaperLinks(html) {
            const links = [];
            const regex = /href=(["'])(forum\?id=[^"']+)\1/g; // href="forum?id=..." ÎòêÎäî href='forum?id=...' Ìå®ÌÑ¥
            let match;
            
            while ((match = regex.exec(html)) !== null) {
                const link = 'https://openreview.net/' + match[2]; // match[2]Í∞Ä forum?id=... Î∂ÄÎ∂Ñ
                if (!links.includes(link)) {
                    links.push(link);
                }
            }
            return links;
        }
        
        function extractRatings(html) {
            const ratings = [];
            // "Rating: 7", "Rating: 8.5" Îì±Ïùò Ìå®ÌÑ¥ÏùÑ Ï∞æÏäµÎãàÎã§.
            const ratingRegex = /Rating: (\d+(\.\d+)?)/g;
            let match;
            
            while ((match = ratingRegex.exec(html)) !== null) {
                const rating = parseFloat(match[1]);
                if (rating >= 1 && rating <= 10) {   // ÏùºÎ∞òÏ†ÅÏù∏ Ï†êÏàò Î≤îÏúÑ
                    ratings.push(rating);
                }
            }
            return ratings;
        }
        
        async function startAnalysis() {
            const startBtn = document.getElementById('startAnalysis');
            const progressContainer = document.getElementById('progressContainer');
            const resultsDiv = document.getElementById('results');
            const maxPapers = parseInt(document.getElementById('maxPapers').value);
            const delay = parseFloat(document.getElementById('delay').value) * 1000;
            
            startBtn.disabled = true;
            progressContainer.style.display = 'block';
            resultsDiv.style.display = 'none';
            allScores = [];
            
            updateStatus('Î∂ÑÏÑùÏùÑ ÏãúÏûëÌï©ÎãàÎã§...', 'info');
            
            try {
                let totalPapers = 0;
                let processedPapers = 0;
                
                // Î®ºÏ†Ä Í∞Å Ïπ¥ÌÖåÍ≥†Î¶¨ÏóêÏÑú ÎÖºÎ¨∏ ÎßÅÌÅ¨Îì§ÏùÑ ÏàòÏßëÌï©ÎãàÎã§
                updateStatus('ÎÖºÎ¨∏ ÎßÅÌÅ¨Î•º ÏàòÏßëÌïòÎäî Ï§ë...', 'info');
                const allPaperLinks = [];
                
                for (const category of categories) {
                    try {
                        updateStatus(`${category.name} Ïπ¥ÌÖåÍ≥†Î¶¨ÏóêÏÑú ÎÖºÎ¨∏ ÎßÅÌÅ¨ ÏàòÏßë Ï§ë...`, 'info');
                        
                        // CORS Ï†úÌïúÏúºÎ°ú Ïù∏Ìï¥ ÏßÅÏ†ë fetchÍ∞Ä Î∂àÍ∞ÄÎä•Ìï† Ïàò ÏûàÏäµÎãàÎã§.
                        // Ïã§Ï†ú Íµ¨ÌòÑÏóêÏÑúÎäî ÌîÑÎ°ùÏãú ÏÑúÎ≤ÑÎÇò Î∞±ÏóîÎìúÍ∞Ä ÌïÑÏöîÌï† Ïàò ÏûàÏäµÎãàÎã§.
                        const html = await fetchWithRetry(category.url);
                        const links = extractPaperLinks(html);
                        const limitedLinks = links.slice(0, maxPapers);
                        
                        allPaperLinks.push(...limitedLinks.map(link => ({ link, category: category.name })));
                        
                        await sleep(delay);
                    } catch (error) {
                        console.error(`Error fetching ${category.name}`, error);
                        updateStatus(`${category.name} Ïπ¥ÌÖåÍ≥†Î¶¨ Ï≤òÎ¶¨ Ï§ë Ïò§Î•ò: ${error.message}`, 'error');
                    }
                }
                
                totalPapers = allPaperLinks.length;
                updateStatus(`Ï¥ù ${totalPapers}Í∞ú ÎÖºÎ¨∏ÏùÑ Î∞úÍ≤¨ÌñàÏäµÎãàÎã§. Ï†êÏàòÎ•º Ï∂îÏ∂úÌïòÎäî Ï§ë...`, 'info');
                
                // Í∞Å ÎÖºÎ¨∏ÏóêÏÑú Ï†êÏàòÎ•º Ï∂îÏ∂úÌï©ÎãàÎã§
                for (const paperInfo of allPaperLinks) {
                    try {
                        updateStatus(`ÎÖºÎ¨∏ ${processedPapers + 1}/${totalPapers} Ï≤òÎ¶¨ Ï§ë... (${paperInfo.category})`, 'info');
                        
                        const html = await fetchWithRetry(paperInfo.link);
                        const ratings = extractRatings(html);
                        
                        if (ratings.length > 0) { // ratings.length > 0ÏúºÎ°ú Ï°∞Í±¥ Î≥ÄÍ≤Ω
                            const averageRating = ratings.reduce((sum, rating) => sum + rating, 0) / ratings.length;
                            allScores.push({
                                category: paperInfo.category,
                                ratings: ratings,
                                average: averageRating,
                                link: paperInfo.link
                            });
                        }
                        
                        processedPapers++;
                        updateProgress(processedPapers, totalPapers);
                        
                        await sleep(delay);
                    } catch (error) {
                        console.error(`Error processing paper ${paperInfo.link}`, error);
                        processedPapers++;
                        updateProgress(processedPapers, totalPapers);
                    }
                }
                
                if (allScores.length === 0) {
                    throw new Error('Ï†êÏàòÎ•º Ï∂îÏ∂úÌï† Ïàò ÏóÜÏäµÎãàÎã§. CORS Ï†ïÏ±ÖÏù¥ÎÇò ÌéòÏù¥ÏßÄ Íµ¨Ï°∞ Î≥ÄÍ≤ΩÏù¥ ÏõêÏù∏Ïùº Ïàò ÏûàÏäµÎãàÎã§.');
                }
                
                updateStatus(`Î∂ÑÏÑù ÏôÑÎ£å! ${allScores.length}Í∞ú ÎÖºÎ¨∏Ïùò Ï†êÏàòÎ•º ÏÑ±Í≥µÏ†ÅÏúºÎ°ú Ï∂îÏ∂úÌñàÏäµÎãàÎã§.`, 'success');
                
                // Í≤∞Í≥º ÏãúÍ∞ÅÌôî
                createHistogram();
                updateStats();
                resultsDiv.style.display = 'grid';
                document.getElementById('personalScoreSection').style.display = 'block';
                
            } catch (error) {
                updateStatus(`Ïò§Î•ò Î∞úÏÉù: ${error.message}`, 'error');
                console.error('Analysis error', error);
            } finally {
                startBtn.disabled = false;
                // progressContainer.style.display = 'none'; // Ï£ºÏÑù Ï≤òÎ¶¨ ÎòêÎäî Ï†úÍ±∞
            }
        }
        
        // Ïã§Ï†ú ÌôòÍ≤ΩÏóêÏÑúÎäî CORS Ï†úÌïúÏúºÎ°ú Ïù∏Ìï¥ ÏßÅÏ†ë Ïä§ÌÅ¨ÎûòÌïëÏù¥ Ïñ¥Î†§Ïö∏ Ïàò ÏûàÏäµÎãàÎã§.
        // Îç∞Î™®Ïö© ÏÉòÌîå Îç∞Ïù¥ÌÑ∞Î•º ÏÉùÏÑ±ÌïòÎäî Ìï®ÏàòÎ•º Ï∂îÍ∞ÄÌï©ÎãàÎã§.
        function generateSampleData() {
            allScores = [];
            const categories = ['Oral', 'Spotlight', 'Poster', 'Reject'];
            // Ïã§Ï†ú NeurIPS 2024 Í∑úÎ™®Ïóê Í∞ÄÍπåÏö¥ ÏÉòÌîå ÌÅ¨Í∏∞
            const sampleSizes = [85, 250, 2200, 8500];
            
            categories.forEach((category, catIndex) => {
                for (let i = 0; i < sampleSizes[catIndex]; i++) {
                    // Ïπ¥ÌÖåÍ≥†Î¶¨Î≥ÑÎ°ú Îã§Î•∏ Ï†êÏàò Î∂ÑÌè¨Î•º ÏãúÎÆ¨Î†àÏù¥ÏÖò
                    let baseScore;
                    switch (category) {
                        case 'Oral': baseScore = 7.5; break;
                        case 'Spotlight': baseScore = 6.5; break;
                        case 'Poster': baseScore = 5.5; break;
                        case 'Reject': baseScore = 4.0; break;
                    }
                    
                    const ratings = [];
                    const numReviewers = Math.floor(Math.random() * 3) + 3; // 3-5 reviewers
                    for (let j = 0; j < numReviewers; j++) {
                        const noise = (Math.random() - 0.5) * 2; // -1 to 1
                        const rating = Math.max(1, Math.min(10, baseScore + noise));
                        ratings.push(Math.round(rating * 10) / 10); // ÏÜåÏàòÏ†ê Ï≤´Ïß∏ ÏûêÎ¶¨ÍπåÏßÄ
                    }
                    
                    const average = ratings.reduce((sum, r) => sum + r, 0) / ratings.length;
                    allScores.push({
                        category,
                        ratings,
                        average: Math.round(average * 10) / 10
                    });
                }
            });
            
            updateStatus(`Ïã§Ï†ú NeurIPS 2024 Í∑úÎ™®Ïóê Í∑ºÏÇ¨Ìïú ÏÉòÌîå Îç∞Ïù¥ÌÑ∞Î°ú ${allScores.length}Í∞ú ÎÖºÎ¨∏ Îç∞Ïù¥ÌÑ∞Î•º ÏÉùÏÑ±ÌñàÏäµÎãàÎã§.`, 'success');
            createHistogram();
            updateStats();
            document.getElementById('results').style.display = 'grid';
        }
        
        function createHistogram() {
            const ctx = document.getElementById('histogramChart').getContext('2d');
            
            if (chart) {
                chart.destroy();
            }
            
            const averageScores = allScores.map(score => score.average);
            
            // ÌûàÏä§ÌÜ†Í∑∏Îû® Îπà ÏÉùÏÑ±
            const minScore = Math.min(...averageScores);
            const maxScore = Math.max(...averageScores);
            const binSize = 0.5;
            const bins = [];
            const binLabels = [];
            
            for (let i = Math.floor(minScore); i <= Math.ceil(maxScore); i += binSize) {
                bins.push(0);
                binLabels.push(`${i.toFixed(1)}-${(i + binSize).toFixed(1)}`);
            }
            
            // Ï†êÏàòÎì§ÏùÑ ÎπàÏóê Î∂ÑÎ∞∞
            averageScores.forEach(score => {
                const binIndex = Math.floor((score - Math.floor(minScore)) / binSize);
                if (binIndex >= 0 && binIndex < bins.length) { // binIndexÍ∞Ä Ïú†Ìö®Ìïú Î≤îÏúÑ ÎÇ¥Ïóê ÏûàÎäîÏßÄ ÌôïÏù∏
                    bins[binIndex]++;
                }
            });
            
            chart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: binLabels,
                    datasets: [{
                        label: 'ÎÖºÎ¨∏ Ïàò',
                        data: bins,
                        backgroundColor: 'rgba(102, 126, 234, 0.6)',
                        borderColor: 'rgba(102, 126, 234, 1)',
                        borderWidth: 2,
                        borderRadius: 8,
                        borderSkipped: false,
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(0, 0, 0, 0.1)'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'ÌèâÍ∑† Ï†êÏàò Î≤îÏúÑ'
                            },
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });
        }
        
        function updateStats() {
            const averageScores = allScores.map(score => score.average);
            const categoryStats = {};
            
            // Ïπ¥ÌÖåÍ≥†Î¶¨Î≥Ñ ÌÜµÍ≥Ñ
            categories.forEach(cat => {
                const catScores = allScores.filter(s => s.category === cat.name).map(s => s.average);
                if (catScores.length > 0) { // catScores.length > 0ÏúºÎ°ú Ï°∞Í±¥ Î≥ÄÍ≤Ω
                    categoryStats[cat.name] = {
                        count: catScores.length,
                        mean: catScores.reduce((sum, s) => sum + s, 0) / catScores.length,
                        min: Math.min(...catScores),
                        max: Math.max(...catScores)
                    };
                }
            });
            
            const totalMean = averageScores.reduce((sum, s) => sum + s, 0) / averageScores.length;
            const sortedScores = [...averageScores].sort((a, b) => a - b);
            const median = sortedScores[Math.floor(sortedScores.length / 2)];
            const stdDev = Math.sqrt(averageScores.reduce((sum, s) => sum + Math.pow(s - totalMean, 2), 0) / averageScores.length);
            
            let statsHTML = `
                <div class="stat-item">
                    <span class="stat-label">Ï¥ù ÎÖºÎ¨∏ Ïàò</span>
                    <span class="stat-value">${allScores.length}</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Ï†ÑÏ≤¥ ÌèâÍ∑†</span>
                    <span class="stat-value">${totalMean.toFixed(2)}</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Ï§ëÏïôÍ∞í</span>
                    <span class="stat-value">${median.toFixed(2)}</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">ÌëúÏ§ÄÌé∏Ï∞®</span>
                    <span class="stat-value">${stdDev.toFixed(2)}</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">ÏµúÏÜåÍ∞í</span>
                    <span class="stat-value">${Math.min(...averageScores).toFixed(2)}</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">ÏµúÎåÄÍ∞í</span>
                    <span class="stat-value">${Math.max(...averageScores).toFixed(2)}</span>
                </div>
            `;
            
            // Ïπ¥ÌÖåÍ≥†Î¶¨Î≥Ñ ÌÜµÍ≥Ñ Ï∂îÍ∞Ä
            Object.entries(categoryStats).forEach(([category, stats]) => {
                statsHTML += `
                    <div style="margin-top: 20px; padding-top: 20px; border-top: 2px solid #f0f0f0;">
                        <h4 style="color: #667eea; margin-bottom: 10px;">${category}</h4>
                        <div class="stat-item">
                            <span class="stat-label">ÎÖºÎ¨∏ Ïàò</span>
                            <span class="stat-value">${stats.count}</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">ÌèâÍ∑†</span>
                            <span class="stat-value">${stats.mean.toFixed(2)}</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Î≤îÏúÑ</span>
                            <span class="stat-value">${stats.min.toFixed(2)} - ${stats.max.toFixed(2)}</span>
                        </div>
                    </div>
                `;
            });
            
            document.getElementById('statsContent').innerHTML = statsHTML;
        }
        
        function analyzePersonalScore() {
            const personalScoresInput = document.getElementById('personalScores').value.trim();
            const analysisDiv = document.getElementById('personalAnalysis');
            
            if (!personalScoresInput) {
                analysisDiv.innerHTML = '<div class="status error">Ï†êÏàòÎ•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.</div>';
                return;
            }
            
            try {
                // Ï†êÏàò ÌååÏã±
                const scores = personalScoresInput.split(',').map(s => {
                    const score = parseFloat(s.trim());
                    if (isNaN(score) || score < 1 || score > 10) { // score < 1 || score > 10ÏúºÎ°ú Ï°∞Í±¥ Î≥ÄÍ≤Ω
                        throw new Error(`Ïú†Ìö®ÌïòÏßÄ ÏïäÏùÄ Ï†êÏàò: ${s.trim()}`);
                    }
                    return score;
                });
                
                if (scores.length === 0) {
                    throw new Error('Ï†êÏàòÎ•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                }
                
                // Í∞úÏù∏ ÌèâÍ∑† Ï†êÏàò Í≥ÑÏÇ∞
                const personalAverage = scores.reduce((sum, score) => sum + score, 0) / scores.length;
                
                // Ï†ÑÏ≤¥ Î∂ÑÌè¨ÏóêÏÑúÏùò ÏúÑÏπò Í≥ÑÏÇ∞
                const allAverages = allScores.map(s => s.average).sort((a, b) => a - b);
                const lowerCount = allAverages.filter(score => score < personalAverage).length;
                const percentile = Math.round((lowerCount / allAverages.length) * 100);
                
                // Ïπ¥ÌÖåÍ≥†Î¶¨Î≥Ñ ÏòàÏÉÅ Í≤∞Í≥º
                let predictedCategory = '';
                let categoryColor = '';
                if (personalAverage >= 7.0) {
                    predictedCategory = 'Oral';
                    categoryColor = '#4caf50';
                } else if (personalAverage >= 6.0) {
                    predictedCategory = 'Spotlight';
                    categoryColor = '#2196f3';
                } else if (personalAverage >= 5.0) {
                    predictedCategory = 'Poster';
                    categoryColor = '#ff9800';
                } else {
                    predictedCategory = 'Reject';
                    categoryColor = '#f44336';
                }
                
                // ÎπÑÏä∑Ìïú Ï†êÏàòÎåÄÏùò ÎÖºÎ¨∏Îì§ Í∞úÏàò
                const similarPapers = allAverages.filter(score => 
                    Math.abs(score - personalAverage) <= 0.2
                ).length;
                
                // Í∞Å Ïπ¥ÌÖåÍ≥†Î¶¨ÏóêÏÑúÏùò ÏúÑÏπò
                const categoryAnalysis = {};
                ['Oral', 'Spotlight', 'Poster', 'Reject'].forEach(category => {
                    const categoryScores = allScores
                        .filter(s => s.category === category)
                        .map(s => s.average)
                        .sort((a, b) => a - b);
                    
                    if (categoryScores.length > 0) { // categoryScores.length > 0ÏúºÎ°ú Ï°∞Í±¥ Î≥ÄÍ≤Ω
                        const categoryLowerCount = categoryScores.filter(score => score < personalAverage).length;
                        const categoryPercentile = Math.round((categoryLowerCount / categoryScores.length) * 100);
                        categoryAnalysis[category] = {
                            percentile: categoryPercentile,
                            total: categoryScores.length,
                            betterThan: categoryLowerCount
                        };
                    }
                });
                
                analysisDiv.innerHTML = `
                    <div style="background: white; padding: 25px; border-radius: 15px; box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);">
                        <h4 style="color: #2c3e50; margin-bottom: 20px; text-align: center;">üìä Ï†êÏàò Î∂ÑÏÑù Í≤∞Í≥º</h4>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 25px;">
                            <div style="text-align: center; padding: 15px; background: #f8f9fa; border-radius: 10px;">
                                <div style="font-size: 0.9em; color: #666; margin-bottom: 5px;">ÏûÖÎ†•Ìïú Ï†êÏàòÎì§</div>
                                <div style="font-size: 1.2em; font-weight: bold; color: #2c3e50;">[${scores.join(', ')}]</div>
                            </div>
                            <div style="text-align: center; padding: 15px; background: #f8f9fa; border-radius: 10px;">
                                <div style="font-size: 0.9em; color: #666; margin-bottom: 5px;">ÌèâÍ∑† Ï†êÏàò</div>
                                <div style="font-size: 1.8em; font-weight: bold; color: #667eea;">${personalAverage.toFixed(2)}</div>
                            </div>
                        </div>
                        
                        <div style="text-align: center; margin-bottom: 25px; padding: 20px; background: linear-gradient(45deg, ${categoryColor}20, ${categoryColor}10); border-radius: 15px; border: 2px solid ${categoryColor}40;">
                            <div style="font-size: 1.1em; color: #666; margin-bottom: 10px;">ÏòàÏÉÅ Í≤∞Í≥º</div>
                            <div style="font-size: 2em; font-weight: bold; color: ${categoryColor}; margin-bottom: 5px;">${predictedCategory}</div>
                            <div style="font-size: 0.9em; color: #666;">Ï†ÑÏ≤¥ ${percentile}Î≤àÏß∏ Î∞±Î∂ÑÏúÑÏàò</div>
                            <div style="font-size: 0.8em; color: #888; margin-top: 5px;">${allAverages.length}Ìé∏ Ï§ë ${lowerCount}Ìé∏Î≥¥Îã§ ÎÜíÏùÄ Ï†êÏàò</div>
                        </div>
                        
                        <div style="margin-bottom: 25px;">
                            <h5 style="color: #2c3e50; margin-bottom: 15px;">üìà Ïπ¥ÌÖåÍ≥†Î¶¨Î≥Ñ ÏÉÅÎåÄÏ†Å ÏúÑÏπò</h5>
                            ${Object.entries(categoryAnalysis).map(([category, data]) => {
                                let categoryBgColor = '';
                                switch(category) {
                                    case 'Oral': categoryBgColor = '#4caf50'; break;
                                    case 'Spotlight': categoryBgColor = '#2196f3'; break;
                                    case 'Poster': categoryBgColor = '#ff9800'; break;
                                    case 'Reject': categoryBgColor = '#f44336'; break;
                                }
                                
                                return `
                                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; margin-bottom: 8px; background: ${categoryBgColor}15; border-radius: 8px; border-left: 4px solid ${categoryBgColor};">
                                        <span style="font-weight: 600; color: ${categoryBgColor};">${category}</span>
                                        <span style="color: #666;">
                                            ${data.percentile}Î≤àÏß∏ Î∞±Î∂ÑÏúÑÏàò (${data.total}Ìé∏ Ï§ë ${data.betterThan}Ìé∏Î≥¥Îã§ ÎÜíÏùå)
                                        </span>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                        
                        <div style="background: #e3f2fd; padding: 15px; border-radius: 10px; border-left: 4px solid #2196f3;">
                            <div style="font-weight: 600; color: #1976d2; margin-bottom: 8px;">üí° Ï∂îÍ∞Ä Ï†ïÎ≥¥</div>
                            <div style="color: #666; font-size: 0.9em; line-height: 1.4;">
                                ‚Ä¢ ÎπÑÏä∑Ìïú Ï†êÏàòÎåÄ(¬±0.2) ÎÖºÎ¨∏ ${similarPapers}Ìé∏<br>
                                ‚Ä¢ ÌëúÏ§ÄÌé∏Ï∞®Î•º Í≥†Î†§Ìï† Îïå, Ïã§Ï†ú Í≤∞Í≥ºÎäî ÏòàÏÉÅÍ≥º Îã§Î•º Ïàò ÏûàÏäµÎãàÎã§<br>
                                ‚Ä¢ Î¶¨Î∑∞Ïñ¥ Ï†êÏàò Ïô∏ÏóêÎèÑ ÌÜ†Î°†, ÏàòÏ†ïÏÇ¨Ìï≠ Îì±Ïù¥ ÏµúÏ¢Ö Í≤∞Í≥ºÏóê ÏòÅÌñ•ÏùÑ Ï§çÎãàÎã§
                            </div>
                        </div>
                    </div>
                `;
                
                // ÌûàÏä§ÌÜ†Í∑∏Îû®Ïóê Í∞úÏù∏ Ï†êÏàò ÌëúÏãú
                updateHistogramWithPersonalScore(personalAverage);
                
            } catch (error) {
                analysisDiv.innerHTML = `<div class="status error">Ïò§Î•ò: ${error.message}</div>`;
            }
        }
        
        function updateHistogramWithPersonalScore(personalScore) {
            if (!chart) return;
            
            // Í∏∞Ï°¥ Í∞úÏù∏ Ï†êÏàò ÎùºÏù∏ Ï†úÍ±∞ (ÎßåÏïΩ ÏûàÎã§Î©¥)
            chart.data.datasets = chart.data.datasets.filter(dataset => dataset.label !== 'ÎÇ¥ Ï†êÏàò');
            
            // Í∞úÏù∏ Ï†êÏàò ÏÑ∏Î°úÏÑ† Ï∂îÍ∞Ä (Line ÌÉÄÏûÖ Îç∞Ïù¥ÌÑ∞ÏÖãÏúºÎ°ú Ï∂îÍ∞Ä)
            chart.data.datasets.push({
                type: 'line', // ÌÉÄÏûÖÏùÄ 'line'ÏúºÎ°ú ÏÑ§Ï†ï
                label: 'ÎÇ¥ Ï†êÏàò',
                data: chart.data.labels.map((label, index) => {
                    // Ìï¥Îãπ binÏùò Î≤îÏúÑ ÎÇ¥Ïóê personalScoreÍ∞Ä ÏûàÎã§Î©¥ Ìï¥Îãπ binÏùò Îç∞Ïù¥ÌÑ∞ Í∞íÏùÑ ÏÇ¨Ïö©
                    const [binStart, binEnd] = label.split('-').map(Number);
                    if (personalScore >= binStart && personalScore < binEnd) {
                        // Ìï¥Îãπ ÎßâÎåÄ Í∑∏ÎûòÌîÑÏùò ÎÜíÏù¥Î≥¥Îã§ ÏïΩÍ∞Ñ ÎÜíÍ≤å ÌëúÏãúÌïòÏó¨ ÏÑ†Ïù¥ Î≥¥Ïù¥ÎèÑÎ°ù Ìï®
                        const barHeight = chart.data.datasets[0].data[index];
                        return barHeight > 0 ? barHeight * 1.1 : 0.1; // 0Ïùº Í≤ΩÏö∞ ÏµúÏÜåÍ∞í ÏÑ§Ï†ï
                    }
                    return null; // Ìï¥Îãπ Î≤îÏúÑ Î∞ñÏù¥Î©¥ Îç∞Ïù¥ÌÑ∞ ÏóÜÏùå
                }),
                borderColor: '#ff6b6b', // ÏÑ† ÏÉâÏÉÅ
                backgroundColor: '#ff6b6b', // Ï†ê ÏÉâÏÉÅ (Chart.js Line ÌÉÄÏûÖÏóêÏÑú Ï†êÏùÑ ÌëúÏãúÌï† Îïå ÏÇ¨Ïö©)
                borderWidth: 4, // ÏÑ† ÍµµÍ∏∞
                pointRadius: 8, // Ï†ê ÌÅ¨Í∏∞
                pointHoverRadius: 10, // Ìò∏Î≤Ñ Ïãú Ï†ê ÌÅ¨Í∏∞
                fill: false, // ÏÑ† ÏïÑÎûò ÏòÅÏó≠ÏùÑ Ï±ÑÏö∏ÏßÄ Ïó¨Î∂Ä
                tension: 0, // ÏÑ†Ïùò Ïû•Î†• (ÏßÅÏÑ†ÏúºÎ°ú ÌëúÏãúÌïòÎ†§Î©¥ 0)
                spanGaps: true // null Í∞íÏùÑ Í±¥ÎÑàÎõ∞Í≥† ÏÑ†ÏùÑ Ïó∞Í≤∞
            });
            
            chart.update();
        }
        
        // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú ÏÉòÌîå Îç∞Ïù¥ÌÑ∞Î°ú Îç∞Î™® ÌëúÏãú
        window.addEventListener('load', function() {
            updateStatus('CORS Ï†úÌïúÏúºÎ°ú Ïù∏Ìï¥ Ïã§Ï†ú OpenReview Îç∞Ïù¥ÌÑ∞Ïóê ÏßÅÏ†ë Ï†ëÍ∑ºÌï† Ïàò ÏóÜÏäµÎãàÎã§. ÏÉòÌîå Îç∞Ïù¥ÌÑ∞Î°ú Í∏∞Îä•ÏùÑ ÏãúÏó∞Ìï©ÎãàÎã§.', 'info');
            setTimeout(() => {
                generateSampleData();
                document.getElementById('personalScoreSection').style.display = 'block';
            }, 1000);
        });
    </script>
</body>
</html>
