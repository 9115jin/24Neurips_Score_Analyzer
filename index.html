<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NeurIPS 2024 ë¦¬ë·° ì ìˆ˜ ë¶„ì„ê¸°</title>
    <script src="https://cdnjs.cloudflare.com/ajaxlibs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }
        
        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 30px;
            font-size: 2.5em;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .control-group {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }
        
        .control-group:hover {
            border-color: #667eea;
            transform: translateY(-2px);
        }
        
        label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: #2c3e50;
        }
        
        input, select, button {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        button {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            cursor: pointer;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s ease;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }
        
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .progress {
            margin: 20px 0;
            background: #f0f0f0;
            border-radius: 10px;
            overflow: hidden;
            height: 20px;
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(45deg, #667eea, #764ba2);
            width: 0%;
            transition: width 0.3s ease;
            position: relative;
        }
        
        .progress-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-weight: 600;
            font-size: 12px;
        }
        
        .status {
            margin: 20px 0;
            padding: 15px;
            border-radius: 10px;
            font-weight: 500;
        }
        
        .status.info {
            background: #e3f2fd;
            color: #1976d2;
            border-left: 5px solid #2196f3;
        }
        
        .status.success {
            background: #e8f5e8;
            color: #2e7d32;
            border-left: 5px solid #4caf50;
        }
        
        .status.error {
            background: #ffebee;
            color: #c62828;
            border-left: 5px solid #f44336;
        }
        
        .results {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-top: 30px;
        }
        
        .chart-container {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        
        .stats {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        
        .stat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .stat-item:last-child {
            border-bottom: none;
        }
        
        .stat-label {
            font-weight: 600;
            color: #2c3e50;
        }
        
        .stat-value {
            font-size: 1.2em;
            font-weight: 700;
            color: #667eea;
        }
        
        @media (max-width: 768px) {
            .results {
                grid-template-columns: 1fr;
            }
            
            .controls {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§  NeurIPS 2024 ë¦¬ë·° ì ìˆ˜ ë¶„ì„ê¸°</h1>
        
        <div id="statusdiv"></div>
        
        <div class="results" id="results">
            <div class="chart-container">
                <h3 style="text-align: center; color: #2c3e50; margin-bottom: 20px;">ì ìˆ˜ ë¶„í¬ íˆìŠ¤í† ê·¸ë¨</h3>
                <canvas id="histogramChart"></canvas>
            </div>
            
            <div class="stats">
                <h3 style="text-align: center; color: #2c3e50; margin-bottom: 20px;">í†µê³„ ìš”ì•½</h3>
                <div id="statsContent"></div>
            </div>
        </div>
        
        <div class="personal-score-section" id="personalScoreSection">
            <div class="control-group" style="margin-top: 30px;">
                <h3 style="color: #2c3e50; margin-bottom: 20px; text-align: center;">ğŸ¯ ë‚´ ë…¼ë¬¸ ì ìˆ˜ ë¶„ì„</h3>
                <label for="personalScores">ë¦¬ë·°ì–´ ì ìˆ˜ë“¤ì„ ì…ë ¥í•˜ì„¸ìš” (ì‰¼í‘œë¡œ êµ¬ë¶„)</label>
                <input type="text" id="personalScores" placeholder="ì˜ˆ: 4,4,5 ë˜ëŠ” 6,7,5,6" style="margin-bottom: 10px;">
                <button onclick="analyzePersonalScore()" style="background: linear-gradient(45deg, #ff6b6b, #ee5a24);">ë‚´ ì ìˆ˜ ë¶„ì„í•˜ê¸°</button>
                <div id="personalAnalysis" style="margin-top: 20px;"></div>
            </div>
        </div>
    </div>

    <script>
        let allScores = [];
        let chart = null;
        
        const categories = [
            { name: 'Oral', url: 'https://openreview.net/group?id=NeurIPS.cc/2024/Conference#tab-accept-oral' },
            { name: 'Spotlight', url: 'https://openreview.net/group?id=NeurIPS.cc/2024/Conference#tab-accept-spotlight' },
            { name: 'Poster', url: 'https://openreview.net/group?id=NeurIPS.cc/2024/Conference#tab-accept-poster' },
            { name: 'Reject', url: 'https://openreview.net/group?id=NeurIPS.cc/2024/Conference#tab-reject' }
        ];
        
        function updateStatus(message, type = 'info') {
            const statusDiv = document.getElementById('statusdiv'); // 'status' -> 'statusdiv'ë¡œ ë³€ê²½
            statusDiv.innerHTML = `<div class="status ${type}">${message}</div>`;
        }
        
        function updateProgress(current, total) {
            const progressBar = document.getElementById('progressBar');
            const progressText = document.getElementById('progressText');
            const percentage = Math.round((current / total) * 100);
            
            progressBar.style.width = percentage + '%';
            progressText.textContent = `${percentage}% (${current}/${total})`;
        }
        
        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }
        
        async function fetchWithRetry(url, retries = 3) {
            for (let i = 0; i < retries; i++) {
                try {
                    const response = await fetch(url);
                    if (response.ok) {
                        return await response.text();
                    }
                    throw new Error(`HTTP ${response.status}`);
                } catch (error) {
                    if (i === retries - 1) throw error;
                    await sleep(2000);
                }
            }
        }
        
        function extractPaperLinks(html) {
            const links = [];
            const regex = /href=(["'])(forum\?id=[^"']+)\1/g; // href="forum?id=..." ë˜ëŠ” href='forum?id=...' íŒ¨í„´
            let match;
            
            while ((match = regex.exec(html)) !== null) {
                const link = 'https://openreview.net/' + match[2]; // match[2]ê°€ forum?id=... ë¶€ë¶„
                if (!links.includes(link)) {
                    links.push(link);
                }
            }
            return links;
        }
        
        function extractRatings(html) {
            const ratings = [];
            // "Rating: 7", "Rating: 8.5" ë“±ì˜ íŒ¨í„´ì„ ì°¾ìŠµë‹ˆë‹¤.
            const ratingRegex = /Rating: (\d+(\.\d+)?)/g;
            let match;
            
            while ((match = ratingRegex.exec(html)) !== null) {
                const rating = parseFloat(match[1]);
                if (rating >= 1 && rating <= 10) {   // ì¼ë°˜ì ì¸ ì ìˆ˜ ë²”ìœ„
                    ratings.push(rating);
                }
            }
            return ratings;
        }
        
        async function startAnalysis() {
            const startBtn = document.getElementById('startAnalysis');
            const progressContainer = document.getElementById('progressContainer');
            const resultsDiv = document.getElementById('results');
            const maxPapers = parseInt(document.getElementById('maxPapers').value);
            const delay = parseFloat(document.getElementById('delay').value) * 1000;
            
            startBtn.disabled = true;
            progressContainer.style.display = 'block';
            resultsDiv.style.display = 'none';
            allScores = [];
            
            updateStatus('ë¶„ì„ì„ ì‹œì‘í•©ë‹ˆë‹¤...', 'info');
            
            try {
                let totalPapers = 0;
                let processedPapers = 0;
                
                // ë¨¼ì € ê° ì¹´í…Œê³ ë¦¬ì—ì„œ ë…¼ë¬¸ ë§í¬ë“¤ì„ ìˆ˜ì§‘í•©ë‹ˆë‹¤
                updateStatus('ë…¼ë¬¸ ë§í¬ë¥¼ ìˆ˜ì§‘í•˜ëŠ” ì¤‘...', 'info');
                const allPaperLinks = [];
                
                for (const category of categories) {
                    try {
                        updateStatus(`${category.name} ì¹´í…Œê³ ë¦¬ì—ì„œ ë…¼ë¬¸ ë§í¬ ìˆ˜ì§‘ ì¤‘...`, 'info');
                        
                        // CORS ì œí•œìœ¼ë¡œ ì¸í•´ ì§ì ‘ fetchê°€ ë¶ˆê°€ëŠ¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                        // ì‹¤ì œ êµ¬í˜„ì—ì„œëŠ” í”„ë¡ì‹œ ì„œë²„ë‚˜ ë°±ì—”ë“œê°€ í•„ìš”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                        const html = await fetchWithRetry(category.url);
                        const links = extractPaperLinks(html);
                        const limitedLinks = links.slice(0, maxPapers);
                        
                        allPaperLinks.push(...limitedLinks.map(link => ({ link, category: category.name })));
                        
                        await sleep(delay);
                    } catch (error) {
                        console.error(`Error fetching ${category.name}`, error);
                        updateStatus(`${category.name} ì¹´í…Œê³ ë¦¬ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜: ${error.message}`, 'error');
                    }
                }
                
                totalPapers = allPaperLinks.length;
                updateStatus(`ì´ ${totalPapers}ê°œ ë…¼ë¬¸ì„ ë°œê²¬í–ˆìŠµë‹ˆë‹¤. ì ìˆ˜ë¥¼ ì¶”ì¶œí•˜ëŠ” ì¤‘...`, 'info');
                
                // ê° ë…¼ë¬¸ì—ì„œ ì ìˆ˜ë¥¼ ì¶”ì¶œí•©ë‹ˆë‹¤
                for (const paperInfo of allPaperLinks) {
                    try {
                        updateStatus(`ë…¼ë¬¸ ${processedPapers + 1}/${totalPapers} ì²˜ë¦¬ ì¤‘... (${paperInfo.category})`, 'info');
                        
                        const html = await fetchWithRetry(paperInfo.link);
                        const ratings = extractRatings(html);
                        
                        if (ratings.length > 0) { // ratings.length > 0ìœ¼ë¡œ ì¡°ê±´ ë³€ê²½
                            const averageRating = ratings.reduce((sum, rating) => sum + rating, 0) / ratings.length;
                            allScores.push({
                                category: paperInfo.category,
                                ratings: ratings,
                                average: averageRating,
                                link: paperInfo.link
                            });
                        }
                        
                        processedPapers++;
                        updateProgress(processedPapers, totalPapers);
                        
                        await sleep(delay);
                    } catch (error) {
                        console.error(`Error processing paper ${paperInfo.link}`, error);
                        processedPapers++;
                        updateProgress(processedPapers, totalPapers);
                    }
                }
                
                if (allScores.length === 0) {
                    throw new Error('ì ìˆ˜ë¥¼ ì¶”ì¶œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. CORS ì •ì±…ì´ë‚˜ í˜ì´ì§€ êµ¬ì¡° ë³€ê²½ì´ ì›ì¸ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
                }
                
                updateStatus(`ë¶„ì„ ì™„ë£Œ! ${allScores.length}ê°œ ë…¼ë¬¸ì˜ ì ìˆ˜ë¥¼ ì„±ê³µì ìœ¼ë¡œ ì¶”ì¶œí–ˆìŠµë‹ˆë‹¤.`, 'success');
                
                // ê²°ê³¼ ì‹œê°í™”
                createHistogram();
                updateStats();
                resultsDiv.style.display = 'grid';
                document.getElementById('personalScoreSection').style.display = 'block';
                
            } catch (error) {
                updateStatus(`ì˜¤ë¥˜ ë°œìƒ: ${error.message}`, 'error');
                console.error('Analysis error', error);
            } finally {
                startBtn.disabled = false;
                // progressContainer.style.display = 'none'; // ì£¼ì„ ì²˜ë¦¬ ë˜ëŠ” ì œê±°
            }
        }
        
        // ì‹¤ì œ í™˜ê²½ì—ì„œëŠ” CORS ì œí•œìœ¼ë¡œ ì¸í•´ ì§ì ‘ ìŠ¤í¬ë˜í•‘ì´ ì–´ë ¤ìš¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        // ë°ëª¨ìš© ìƒ˜í”Œ ë°ì´í„°ë¥¼ ìƒì„±í•˜ëŠ” í•¨ìˆ˜ë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.
        function generateSampleData() {
            allScores = [];
            const categories = ['Oral', 'Spotlight', 'Poster', 'Reject'];
            // ì‹¤ì œ NeurIPS 2024 ê·œëª¨ì— ê°€ê¹Œìš´ ìƒ˜í”Œ í¬ê¸°
            const sampleSizes = [85, 250, 2200, 8500];
            
            categories.forEach((category, catIndex) => {
                for (let i = 0; i < sampleSizes[catIndex]; i++) {
                    // ì¹´í…Œê³ ë¦¬ë³„ë¡œ ë‹¤ë¥¸ ì ìˆ˜ ë¶„í¬ë¥¼ ì‹œë®¬ë ˆì´ì…˜
                    let baseScore;
                    switch (category) {
                        case 'Oral': baseScore = 7.5; break;
                        case 'Spotlight': baseScore = 6.5; break;
                        case 'Poster': baseScore = 5.5; break;
                        case 'Reject': baseScore = 4.0; break;
                    }
                    
                    const ratings = [];
                    const numReviewers = Math.floor(Math.random() * 3) + 3; // 3-5 reviewers
                    for (let j = 0; j < numReviewers; j++) {
                        const noise = (Math.random() - 0.5) * 2; // -1 to 1
                        const rating = Math.max(1, Math.min(10, baseScore + noise));
                        ratings.push(Math.round(rating * 10) / 10); // ì†Œìˆ˜ì  ì²«ì§¸ ìë¦¬ê¹Œì§€
                    }
                    
                    const average = ratings.reduce((sum, r) => sum + r, 0) / ratings.length;
                    allScores.push({
                        category,
                        ratings,
                        average: Math.round(average * 10) / 10
                    });
                }
            });
            
            updateStatus(`ì‹¤ì œ NeurIPS 2024 ê·œëª¨ì— ê·¼ì‚¬í•œ ìƒ˜í”Œ ë°ì´í„°ë¡œ ${allScores.length}ê°œ ë…¼ë¬¸ ë°ì´í„°ë¥¼ ìƒì„±í–ˆìŠµë‹ˆë‹¤.`, 'success');
            createHistogram();
            updateStats();
            document.getElementById('results').style.display = 'grid';
        }
        
        function createHistogram() {
            const ctx = document.getElementById('histogramChart').getContext('2d');
            
            if (chart) {
                chart.destroy();
            }
            
            const averageScores = allScores.map(score => score.average);
            
            // íˆìŠ¤í† ê·¸ë¨ ë¹ˆ ìƒì„±
            const minScore = Math.min(...averageScores);
            const maxScore = Math.max(...averageScores);
            const binSize = 0.5;
            const bins = [];
            const binLabels = [];
            
            for (let i = Math.floor(minScore); i <= Math.ceil(maxScore); i += binSize) {
                bins.push(0);
                binLabels.push(`${i.toFixed(1)}-${(i + binSize).toFixed(1)}`);
            }
            
            // ì ìˆ˜ë“¤ì„ ë¹ˆì— ë¶„ë°°
            averageScores.forEach(score => {
                const binIndex = Math.floor((score - Math.floor(minScore)) / binSize);
                if (binIndex >= 0 && binIndex < bins.length) { // binIndexê°€ ìœ íš¨í•œ ë²”ìœ„ ë‚´ì— ìˆëŠ”ì§€ í™•ì¸
                    bins[binIndex]++;
                }
            });
            
            chart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: binLabels,
                    datasets: [{
                        label: 'ë…¼ë¬¸ ìˆ˜',
                        data: bins,
                        backgroundColor: 'rgba(102, 126, 234, 0.6)',
                        borderColor: 'rgba(102, 126, 234, 1)',
                        borderWidth: 2,
                        borderRadius: 8,
                        borderSkipped: false,
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(0, 0, 0, 0.1)'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'í‰ê·  ì ìˆ˜ ë²”ìœ„'
                            },
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });
        }
        
        function updateStats() {
            const averageScores = allScores.map(score => score.average);
            const categoryStats = {};
            
            // ì¹´í…Œê³ ë¦¬ë³„ í†µê³„
            categories.forEach(cat => {
                const catScores = allScores.filter(s => s.category === cat.name).map(s => s.average);
                if (catScores.length > 0) { // catScores.length > 0ìœ¼ë¡œ ì¡°ê±´ ë³€ê²½
                    categoryStats[cat.name] = {
                        count: catScores.length,
                        mean: catScores.reduce((sum, s) => sum + s, 0) / catScores.length,
                        min: Math.min(...catScores),
                        max: Math.max(...catScores)
                    };
                }
            });
            
            const totalMean = averageScores.reduce((sum, s) => sum + s, 0) / averageScores.length;
            const sortedScores = [...averageScores].sort((a, b) => a - b);
            const median = sortedScores[Math.floor(sortedScores.length / 2)];
            const stdDev = Math.sqrt(averageScores.reduce((sum, s) => sum + Math.pow(s - totalMean, 2), 0) / averageScores.length);
            
            let statsHTML = `
                <div class="stat-item">
                    <span class="stat-label">ì´ ë…¼ë¬¸ ìˆ˜</span>
                    <span class="stat-value">${allScores.length}</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">ì „ì²´ í‰ê· </span>
                    <span class="stat-value">${totalMean.toFixed(2)}</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">ì¤‘ì•™ê°’</span>
                    <span class="stat-value">${median.toFixed(2)}</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">í‘œì¤€í¸ì°¨</span>
                    <span class="stat-value">${stdDev.toFixed(2)}</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">ìµœì†Œê°’</span>
                    <span class="stat-value">${Math.min(...averageScores).toFixed(2)}</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">ìµœëŒ€ê°’</span>
                    <span class="stat-value">${Math.max(...averageScores).toFixed(2)}</span>
                </div>
            `;
            
            // ì¹´í…Œê³ ë¦¬ë³„ í†µê³„ ì¶”ê°€
            Object.entries(categoryStats).forEach(([category, stats]) => {
                statsHTML += `
                    <div style="margin-top: 20px; padding-top: 20px; border-top: 2px solid #f0f0f0;">
                        <h4 style="color: #667eea; margin-bottom: 10px;">${category}</h4>
                        <div class="stat-item">
                            <span class="stat-label">ë…¼ë¬¸ ìˆ˜</span>
                            <span class="stat-value">${stats.count}</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">í‰ê· </span>
                            <span class="stat-value">${stats.mean.toFixed(2)}</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">ë²”ìœ„</span>
                            <span class="stat-value">${stats.min.toFixed(2)} - ${stats.max.toFixed(2)}</span>
                        </div>
                    </div>
                `;
            });
            
            document.getElementById('statsContent').innerHTML = statsHTML;
        }
        
        function analyzePersonalScore() {
            const personalScoresInput = document.getElementById('personalScores').value.trim();
            const analysisDiv = document.getElementById('personalAnalysis');
            
            if (!personalScoresInput) {
                analysisDiv.innerHTML = '<div class="status error">ì ìˆ˜ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.</div>';
                return;
            }
            
            try {
                // ì ìˆ˜ íŒŒì‹±
                const scores = personalScoresInput.split(',').map(s => {
                    const score = parseFloat(s.trim());
                    if (isNaN(score) || score < 1 || score > 10) { // score < 1 || score > 10ìœ¼ë¡œ ì¡°ê±´ ë³€ê²½
                        throw new Error(`ìœ íš¨í•˜ì§€ ì•Šì€ ì ìˆ˜: ${s.trim()}`);
                    }
                    return score;
                });
                
                if (scores.length === 0) {
                    throw new Error('ì ìˆ˜ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                }
                
                // ê°œì¸ í‰ê·  ì ìˆ˜ ê³„ì‚°
                const personalAverage = scores.reduce((sum, score) => sum + score, 0) / scores.length;
                
                // ì „ì²´ ë¶„í¬ì—ì„œì˜ ìœ„ì¹˜ ê³„ì‚°
                const allAverages = allScores.map(s => s.average).sort((a, b) => a - b);
                const lowerCount = allAverages.filter(score => score < personalAverage).length;
                const percentile = Math.round((lowerCount / allAverages.length) * 100);
                
                // ì¹´í…Œê³ ë¦¬ë³„ ì˜ˆìƒ ê²°ê³¼
                let predictedCategory = '';
                let categoryColor = '';
                if (personalAverage >= 7.0) {
                    predictedCategory = 'Oral';
                    categoryColor = '#4caf50';
                } else if (personalAverage >= 6.0) {
                    predictedCategory = 'Spotlight';
                    categoryColor = '#2196f3';
                } else if (personalAverage >= 5.0) {
                    predictedCategory = 'Poster';
                    categoryColor = '#ff9800';
                } else {
                    predictedCategory = 'Reject';
                    categoryColor = '#f44336';
                }
                
                // ë¹„ìŠ·í•œ ì ìˆ˜ëŒ€ì˜ ë…¼ë¬¸ë“¤ ê°œìˆ˜
                const similarPapers = allAverages.filter(score => 
                    Math.abs(score - personalAverage) <= 0.2
                ).length;
                
                // ê° ì¹´í…Œê³ ë¦¬ì—ì„œì˜ ìœ„ì¹˜
                const categoryAnalysis = {};
                ['Oral', 'Spotlight', 'Poster', 'Reject'].forEach(category => {
                    const categoryScores = allScores
                        .filter(s => s.category === category)
                        .map(s => s.average)
                        .sort((a, b) => a - b);
                    
                    if (categoryScores.length > 0) { // categoryScores.length > 0ìœ¼ë¡œ ì¡°ê±´ ë³€ê²½
                        const categoryLowerCount = categoryScores.filter(score => score < personalAverage).length;
                        const categoryPercentile = Math.round((categoryLowerCount / categoryScores.length) * 100);
                        categoryAnalysis[category] = {
                            percentile: categoryPercentile,
                            total: categoryScores.length,
                            betterThan: categoryLowerCount
                        };
                    }
                });
                
                analysisDiv.innerHTML = `
                    <div style="background: white; padding: 25px; border-radius: 15px; box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);">
                        <h4 style="color: #2c3e50; margin-bottom: 20px; text-align: center;">ğŸ“Š ì ìˆ˜ ë¶„ì„ ê²°ê³¼</h4>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 25px;">
                            <div style="text-align: center; padding: 15px; background: #f8f9fa; border-radius: 10px;">
                                <div style="font-size: 0.9em; color: #666; margin-bottom: 5px;">ì…ë ¥í•œ ì ìˆ˜ë“¤</div>
                                <div style="font-size: 1.2em; font-weight: bold; color: #2c3e50;">[${scores.join(', ')}]</div>
                            </div>
                            <div style="text-align: center; padding: 15px; background: #f8f9fa; border-radius: 10px;">
                                <div style="font-size: 0.9em; color: #666; margin-bottom: 5px;">í‰ê·  ì ìˆ˜</div>
                                <div style="font-size: 1.8em; font-weight: bold; color: #667eea;">${personalAverage.toFixed(2)}</div>
                            </div>
                        </div>
                        
                        <div style="text-align: center; margin-bottom: 25px; padding: 20px; background: linear-gradient(45deg, ${categoryColor}20, ${categoryColor}10); border-radius: 15px; border: 2px solid ${categoryColor}40;">
                            <div style="font-size: 1.1em; color: #666; margin-bottom: 10px;">ì˜ˆìƒ ê²°ê³¼</div>
                            <div style="font-size: 2em; font-weight: bold; color: ${categoryColor}; margin-bottom: 5px;">${predictedCategory}</div>
                            <div style="font-size: 0.9em; color: #666;">ì „ì²´ ${percentile}ë²ˆì§¸ ë°±ë¶„ìœ„ìˆ˜</div>
                            <div style="font-size: 0.8em; color: #888; margin-top: 5px;">${allAverages.length}í¸ ì¤‘ ${lowerCount}í¸ë³´ë‹¤ ë†’ì€ ì ìˆ˜</div>
                        </div>
                        
                        <div style="margin-bottom: 25px;">
                            <h5 style="color: #2c3e50; margin-bottom: 15px;">ğŸ“ˆ ì¹´í…Œê³ ë¦¬ë³„ ìƒëŒ€ì  ìœ„ì¹˜</h5>
                            ${Object.entries(categoryAnalysis).map(([category, data]) => {
                                let categoryBgColor = '';
                                switch(category) {
                                    case 'Oral': categoryBgColor = '#4caf50'; break;
                                    case 'Spotlight': categoryBgColor = '#2196f3'; break;
                                    case 'Poster': categoryBgColor = '#ff9800'; break;
                                    case 'Reject': categoryBgColor = '#f44336'; break;
                                }
                                
                                return `
                                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; margin-bottom: 8px; background: ${categoryBgColor}15; border-radius: 8px; border-left: 4px solid ${categoryBgColor};">
                                        <span style="font-weight: 600; color: ${categoryBgColor};">${category}</span>
                                        <span style="color: #666;">
                                            ${data.percentile}ë²ˆì§¸ ë°±ë¶„ìœ„ìˆ˜ (${data.total}í¸ ì¤‘ ${data.betterThan}í¸ë³´ë‹¤ ë†’ìŒ)
                                        </span>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                        
                        <div style="background: #e3f2fd; padding: 15px; border-radius: 10px; border-left: 4px solid #2196f3;">
                            <div style="font-weight: 600; color: #1976d2; margin-bottom: 8px;">ğŸ’¡ ì¶”ê°€ ì •ë³´</div>
                            <div style="color: #666; font-size: 0.9em; line-height: 1.4;">
                                â€¢ ë¹„ìŠ·í•œ ì ìˆ˜ëŒ€(Â±0.2) ë…¼ë¬¸ ${similarPapers}í¸<br>
                                â€¢ í‘œì¤€í¸ì°¨ë¥¼ ê³ ë ¤í•  ë•Œ, ì‹¤ì œ ê²°ê³¼ëŠ” ì˜ˆìƒê³¼ ë‹¤ë¥¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤<br>
                                â€¢ ë¦¬ë·°ì–´ ì ìˆ˜ ì™¸ì—ë„ í† ë¡ , ìˆ˜ì •ì‚¬í•­ ë“±ì´ ìµœì¢… ê²°ê³¼ì— ì˜í–¥ì„ ì¤ë‹ˆë‹¤
                            </div>
                        </div>
                    </div>
                `;
                
                // íˆìŠ¤í† ê·¸ë¨ì— ê°œì¸ ì ìˆ˜ í‘œì‹œ
                updateHistogramWithPersonalScore(personalAverage);
                
            } catch (error) {
                analysisDiv.innerHTML = `<div class="status error">ì˜¤ë¥˜: ${error.message}</div>`;
            }
        }
        
        function updateHistogramWithPersonalScore(personalScore) {
            if (!chart) return;
            
            // ê¸°ì¡´ ê°œì¸ ì ìˆ˜ ë¼ì¸ ì œê±° (ë§Œì•½ ìˆë‹¤ë©´)
            chart.data.datasets = chart.data.datasets.filter(dataset => dataset.label !== 'ë‚´ ì ìˆ˜');
            
            // ê°œì¸ ì ìˆ˜ ì„¸ë¡œì„  ì¶”ê°€ (Line íƒ€ì… ë°ì´í„°ì…‹ìœ¼ë¡œ ì¶”ê°€)
            chart.data.datasets.push({
                type: 'line', // íƒ€ì…ì€ 'line'ìœ¼ë¡œ ì„¤ì •
                label: 'ë‚´ ì ìˆ˜',
                data: chart.data.labels.map((label, index) => {
                    // í•´ë‹¹ binì˜ ë²”ìœ„ ë‚´ì— personalScoreê°€ ìˆë‹¤ë©´ í•´ë‹¹ binì˜ ë°ì´í„° ê°’ì„ ì‚¬ìš©
                    const [binStart, binEnd] = label.split('-').map(Number);
                    if (personalScore >= binStart && personalScore < binEnd) {
                        // í•´ë‹¹ ë§‰ëŒ€ ê·¸ë˜í”„ì˜ ë†’ì´ë³´ë‹¤ ì•½ê°„ ë†’ê²Œ í‘œì‹œí•˜ì—¬ ì„ ì´ ë³´ì´ë„ë¡ í•¨
                        const barHeight = chart.data.datasets[0].data[index];
                        return barHeight > 0 ? barHeight * 1.1 : 0.1; // 0ì¼ ê²½ìš° ìµœì†Œê°’ ì„¤ì •
                    }
                    return null; // í•´ë‹¹ ë²”ìœ„ ë°–ì´ë©´ ë°ì´í„° ì—†ìŒ
                }),
                borderColor: '#ff6b6b', // ì„  ìƒ‰ìƒ
                backgroundColor: '#ff6b6b', // ì  ìƒ‰ìƒ (Chart.js Line íƒ€ì…ì—ì„œ ì ì„ í‘œì‹œí•  ë•Œ ì‚¬ìš©)
                borderWidth: 4, // ì„  êµµê¸°
                pointRadius: 8, // ì  í¬ê¸°
                pointHoverRadius: 10, // í˜¸ë²„ ì‹œ ì  í¬ê¸°
                fill: false, // ì„  ì•„ë˜ ì˜ì—­ì„ ì±„ìš¸ì§€ ì—¬ë¶€
                tension: 0, // ì„ ì˜ ì¥ë ¥ (ì§ì„ ìœ¼ë¡œ í‘œì‹œí•˜ë ¤ë©´ 0)
                spanGaps: true // null ê°’ì„ ê±´ë„ˆë›°ê³  ì„ ì„ ì—°ê²°
            });
            
            chart.update();
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìƒ˜í”Œ ë°ì´í„°ë¡œ ë°ëª¨ í‘œì‹œ
        window.addEventListener('load', function() {
            updateStatus('CORS ì œí•œìœ¼ë¡œ ì¸í•´ ì‹¤ì œ OpenReview ë°ì´í„°ì— ì§ì ‘ ì ‘ê·¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ìƒ˜í”Œ ë°ì´í„°ë¡œ ê¸°ëŠ¥ì„ ì‹œì—°í•©ë‹ˆë‹¤.', 'info');
            setTimeout(() => {
                generateSampleData();
                document.getElementById('personalScoreSection').style.display = 'block';
            }, 1000);
        });
    </script>
</body>
</html>
